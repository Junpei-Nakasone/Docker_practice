# Docker_memo  

`docker run --name コンテナ名 -d \  
-p ホストのポート番号:コンテナのポート番号 \
イメージ名`  

#### --name  

#### nginxでhttpメソッド制限するには  
起動中のnginxのdefault.confをコピーして取得  
`docker cp tmp-nginx:etc/nginx/conf.d/default.conf ./`  

ローカルのディレクトリでdefault.confの設定を変更  
`  location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
        limit_except POST {
        deny all;
}`  

 
default.conf をコピーするDockerfileを作成
`FROM nginx:latest
COPY default.conf /etc/nginx/conf.d/default.conf`  
  
  
イメージをbuild  
`docker build -t nginx:ver1 .`  

作成したイメージからコンテナを実行  
`docker run --name web -p 8080:80 --rm nginx:ver1`


# docker-compose  
webサーバー、DBサーバー、キャッシュサーバーなど定義を一つのymlファイルに記述しておくことで、そのymlファイルを基にアプリケーションに必要なコンテナをまとめて起動できる  

#### ymlとは  
構造化されたデータを表現するためのフォーマット。直感的に書かれているのでファイルを見れば構造は大体理解できる。  
##### Compose実行ステップ  
1. Docker imageをビルドするためのDockerfileを用意するか、使用するイメージをDocker Hubなどに用意する  
2. docker-compose.ymlを定義する。このファイルにコンテナ毎の起動時の設定を書き込む。これはdocker-runコマンドで各種設定をするようなもの。  
3. docker-compose.ymlを置いてあるディレクトリでdocker-compose upを実行する。単純にdocker-compose upだとフォアグラウンドで起動するので、実際には-dをつけてデタッチドモードで起動することが多い。コマンドを実行するとdocker-compose.ymlの設定に従って各コンテナが実行される。  

# Dockerにおけるデータ管理について
コンテナで扱う動的なデータは起動中のコンテナの読み書き可能なレイヤーに置くこともできるが、いくつかのデメリットがある。例えば、コンテナが削除された時点でコンテナに置いてあったデータが消えたり、コンテナ間でデータを共有することができない、など。そのほかに書き込みのパフォーマンスもホスト上にデータを書き込むのに比べて、書き込みのパフォーマンスが良くない。これは、コンテナへの読み書き可能なレイヤーへの書き込みは、通常のファイルシステムとは異なるUnion Filesystemが利用されているため。
Dockerにはホスト上のディレクトリやファイルをコンテナにマウントする仕組みや、ホストのメモリをファイルシステムとしてコンテナにマウントする仕組みが用意されている。


# Dockerでできること  
#### 開発環境の構築  
よくあるアプリケーションの開発の現場では、開発環境を構築する場合に、それぞれのメンバーが開発言語の動作環境を用意し、DBサーバーを構築するという作業が発生します。開発者一人一人がそういう作業を行うと、それぞれがインストールしたミドルウェアのバージョンに差異が生じ、環境依存によって動作しないケースが発生したり、環境構築そのものに時間がかかってしまうなどの問題が起こりがち。  
Dockerで開発環境を用意できれば、そういう作業がものすごく簡単になる。また、アプリケーション実行環境の立ち上げがスピーディーになる。  
Dockerを使用して開発環境を作れるようになることで、新しい言語やDBなどを触ってみたい場合に、検証環境を簡単に立ち上げることができるので、これからすごく役に立つスキルになる。  

#### クラウド環境にDockerコンテナをデプロイする  
本番環境でアプリを動かす場合、AWSやGCPを利用することが多い。そこで、自分のPCで動作したものをクラウド環境で動作させる際に、Dockerが役立つ。
